<%= render "shared/header" %>
<%= render "rootpost" %>
<main>
  <div class="text-alert">
    <%= flash.now[:alert] %>
  </div>
  <div class = "main">
    <div class = "left-bar"></div>
    <div class = "center">
      <%#投稿した時の画面%>
      <% @roots.each do |root| %>
      <div class = "share-content">
        <div class = "share-content-main">
          <div class = "img-name-title-edit">
            <div class = "img-name-title">
              <div class = "user-image"></div>
              <div>
                <p class = "name-content"><%=root.user.nickname%></p>
                <p class = "title-content"><%=root.title%></p>
              </div>
            </div>
            <%if current_user.id == root.user_id%>
            <div class = "ed-de">･･･</div>
            <ul class = "content-lists" id = "content-pulldown" style = "display: none;">
              <li><%=link_to "編集", "/", class: "content-pulldown-btn" %></li>
              <li><%= link_to "削除", "/roots/#{root.id}", class: "content-pulldown-btn", method: :delete%></li>
            </ul>
            <script>
            /*$('.ed-de').on('click',function(){
              $(this).closest(".img-name-title-edit").find(".content-lists").show();
            });
            $(document).on('click',function(e){
              if(!$(e.target).closest('.img-name-title-edit').length){
                $('.content-lists').hide();
              };
            });*/
            $('.ed-de').on({'mouseenter':function(){
              $(this).closest(".img-name-title-edit").find(".content-lists").show();
            },
            'mouseleave': function(){
              $(this).closest(".img-name-title-edit").find(".content-lists").hide();
            }
            });
            
            $('.content-lists').on({'mouseenter':function(){
              $(this).closest(".img-name-title-edit").find(".content-lists").show();
            },
            'mouseleave': function(){
              $(this).closest(".img-name-title-edit").find(".content-lists").hide();
            }
            });
            </script>
            <%end%>
          </div>
          <%#もっと見る。のコード%>
          <%if root.content.length > 20%>
            <p class = "text-content" id = "close-content"><%=safe_join(root.content.truncate(20).split("\n"),tag(:br))%>
            <span class = "more-content" id = "more-content" style = "cursor: pointer;">もっと見る</span></p>
            <p class = "text-open-content hidden" id = "open-content"><%=safe_join(root.content.split("\n"),tag(:br))%></p>
            <script>
            $('.more-content').click(function(){
              $(this).closest(".share-content-main").find(".text-content").hide();
              $(this).closest(".share-content-main").find(".text-open-content").show();
            });
            </script>
          <%else%>
          <p class = "text-content"><%=safe_join(root.content.split("\n"),tag(:br))%></p>
          <%end%>
          <%#もっと見る。のコード%>
          <%if root.share.present?%>
          <%= link_to 'url', root.share, class: "url-content",target: :_blank, rel: "noopener noreferrer"%>
          <%end%>
          <div class = "image-box"><%=image_tag root.image, class: "image-content" if root.image.attached?%></div>
          <div class = "action-content">
            <%= link_to image_tag("like.png", class:"like-icon", size: "36x36"), "/" %>
            <%= link_to 'コメントを見る', '/', class: "look-comment"%>
          </div>
        </div>
        <div class = "form-content">
          <%#= form_with(model: '', local: true) do |form| %>
            <%#= form.text_area :text, placeholder: "text", rows: "1" ,class: "form-comment" %>
            <%#= form.submit "SEND", class:"send-form"%>
          <%# end %>
          <textarea rows = "1" placeholder = "コメントを入力" class = "form-comment"></textarea>
          <input type = "submit" value = "画像" class = "send-form">
        </div>
      </div>
      <%end%>
      <%#投稿した時の画面%>
    </div>
    <div class = "right-bar"></div>
  </div>
</main>